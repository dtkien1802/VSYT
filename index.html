<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <title>Controller</title>
</head>
<body style="background-color: black; color: white">
    <div class="container mb-5 mt-5">
        <div class="text-center">
            <h1>CONFIGURATION PAGE</h1>
        </div>
    </div>
    <div class="row justify-content-md-center">
        <nav class="navbar navbar-expand-lg navbar-light bg-light col-11">
            <a class="navbar-brand" href="index.html">Trang chủ</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item active">
                <a class="nav-link" href="page1.html">Hệ thống 1</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="#">Hệ thống 2</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="#">Hệ thống 3</a>
                </li>
            </ul>
            </div>
        </nav>
    </div>
    <div class="row justify-content-md-center mt-5 mb-5">
        <div class="col-9">
                <div class="row form-group mb-4">
                    <label class="col-sm-3" for="accountfile">Chọn file tài khoản</label>
                    <div class="row col-sm-9">
                        <div class="col-sm-10">
                            <input type="file" class="form-control" id="accountfile" accept=".txt">
                        </div>
                        <small>Mỗi dòng 1 máy theo định dạng username|password</small>
                        <small>Ví dụ: abc123|123456</small>
                    </div>
                </div>
                <div class="row form-group mb-4">
                    <label class="col-sm-3" for="videofile">Chọn file keyword - title</label>
                    <div class="row col-sm-9">
                        <div class="col-sm-10">
                            <input type="file" class="form-control" id="videofile" accept=".txt">
                        </div>
                        <small>Mỗi dòng theo định dạng keyword;video title;%watch, hết 1 máy cách 1 dòng</small>
                        <small>Ví dụ: vtv24;Tổng hợp bàn thắng Vòng 1/8 UEFA EURO 2020 | Kịch tính và nhiều bất ngờ;90</small>
                    </div>
                </div>
                <div class="row form-group mb-4">
                    <label class="col-sm-3" for="comment">Comment</label>
                    <div class="row col-sm-9">
                        <div class="col-sm-10">
                            <textarea class="form-control" id="comment"></textarea>
                        </div>
                        <button class="btn btn-primary col-sm-2" onclick="updateComment()">Save</button>
                        <small>Mỗi dòng một comment</small> 
                    </div>
                </div>
                <div class="row form-group mb-4">
                    <label class="col-sm-3" for="timeFile">Chọn file thời gian<br>like-comment-subscribe</label>
                    <div class="row col-sm-9">
                        <div class="col-sm-10">
                            <input type="file" class="form-control" id="timeFile" accept=".txt">
                        </div>
                        <small>Mỗi dòng một máy theo định dạng thời gian like-thời gian comment-thời gian share</small>
                        <small>Ví dụ: 5-10-15</small>
                    </div>
                </div>
                <div class="row form-group">
                    <label class="col-sm-3" for="actionFile">Chọn file tuỳ chọn</label>
                    <div class="row col-sm-9">
                        <div class="col-sm-10">
                            <input type="file" class="form-control" id="actionFile" accept=".txt">
                        </div>
                        <small>Mỗi dòng một máy theo định dạng Subscribe video đầu tiên-Like video-Comment video-Comment video-Subscribe kênh-Skip quảng cáo</small>
                        <small>Ví dụ: 0-0-1-1-1</small>
                    </div>
                </div>
           
        </div>
    </div>

    <div class="">
        <div class="col-10"></div>
        <table class="table table-dark table-striped table-hover table-bordered" id="myTable">
            <tr>
                <th class="col-1">Máy</th>
                <th class="col-1">Username</th>
                <th class="col-1">Password</th>
                <th class="col-4">Keyword - Video title - %watch</th>
                <th class="col-2">Comment</th>
                <th class="col-2">Tuỳ chọn</th>
                <td class="col-1">Thời gian</td>
                <td class="col-1">Trạng thái</td>
                <th class="col-1"></th>
        </table>
        </div>
    </div>

</body>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        //get the list
        socket.on('computer', function(computers) {
            for(let i = 0; i<computers.length; i++){
                console.log(computers[i][0].substring(0, 5));
                if(computers[i][0].substring(0, 5)=="NET01"){
                var table = document.getElementById("myTable");
                var row = table.insertRow(-1);
                var computerIP = row.insertCell(0);
                var username = row.insertCell(1);
                var password = row.insertCell(2);
                var videoList = row.insertCell(3);
                var comment = row.insertCell(4);
                var option = row.insertCell(5);
                var time = row.insertCell(6);
                var status = row.insertCell(7);
                var button = row.insertCell(8);
                computerIP.innerHTML = computers[i][0];
                let list = "";
                for(let j = 0; j<computers[i][3].length; j++) {
                    list=list+"<p>"+computers[i][3][j].search+" "+computers[i][3][j].title+" "+computers[i][3][j].watch + "<\p>";
                }
                let commentlist = "";
                for(let j = 0; j<computers[i][4].length; j++) {
                    commentlist=commentlist+"<p>"+computers[i][4][j] + "<\p>";
                }
                //[ip, username, password, videolist, comment, option, status]
                username.innerHTML = "<p id=\"curusername"+computers[i][0]+"\" class=\"col-sm-12\">"+computers[i][1]+"</p><input class=\"col-sm-12\" id=\"username"+computers[i][0]+"\" type=\"text\" autocomplete=\"off\">";
                password.innerHTML = "<p id=\"curpassword"+computers[i][0]+"\" class=\"col-sm-12\">"+computers[i][2]+"</p><input class=\"col-sm-12\" id=\"password"+computers[i][0]+"\" type=\"text\" autocomplete=\"off\">";
                videoList.innerHTML = "<p id=\"curlist"+computers[i][0]+"\" class=\"col-sm-12\">"+list+"</p><textarea class=\"col-sm-12\" id=\"list"+computers[i][0]+"\" type=\"text\" autocomplete=\"off\"></textarea>";
                comment.innerHTML = "<p id=\"curcomment"+computers[i][0]+"\" class=\"col-sm-12\">"+commentlist+"</p><textarea class=\"col-sm-12\" id=\"comment"+computers[i][0]+"\" type=\"text\" autocomplete=\"off\"></textarea>";
                option.innerHTML = "<p id=\"curoption"+computers[i][0]+"\" class=\"col-sm-12\">"+computers[i][6]+"</p><textarea class=\"col-sm-12\" id=\"option"+computers[i][0]+"\" type=\"text\" autocomplete=\"off\"></textarea>";
                time.innerHTML = "<p id=\"curtime"+computers[i][0]+"\" class=\"col-sm-12\">"+computers[i][5]+"</p><input class=\"col-sm-12\" id=\"time"+computers[i][0]+"\" type=\"text\" autocomplete=\"off\">"
                status.innerHTML = "<p id=\"status"+computers[i][0]+"\">" + computers[i][7]+"</p>";
                button.innerHTML = "<button class=\"col-12\" id=\""+computers[i][0]+"\"onclick=\"update(this.id)\">Cập nhật</button><button class=\"col-12\" id=\""+computers[i][0]+"\"onclick=\"run(this.id)\">Chạy!</button><button class=\"col-12\">Dừng</button>"
            }
            }
        });
        //update all
        function update(idno) {
            var username = document.getElementById("username"+idno).value;
            var password = document.getElementById("password"+idno).value;
            var list = document.getElementById("list"+idno).value;
            var comment = document.getElementById("comment"+idno).value;
            var action = document.getElementById("option"+idno).value;
            var time = document.getElementById("time"+idno).value;

            document.getElementById("curusername"+idno).innerHTML = username;
            document.getElementById("curpassword"+idno).innerHTML = password;
            document.getElementById("curlist"+idno).innerHTML = list;
            document.getElementById("curcomment"+idno).innerHTML = comment;
            document.getElementById("curoption"+idno).innerHTML = action;
            document.getElementById("curtime"+idno).innerHTML = time;
            
            socket.emit('update', {username: username, password: password, ipaddr: idno, list: list, comment:comment, action:action, time:time});
        }

        //run clicked
        function run(idno) {
            socket.emit('run', idno);
        }

        //comment input
        function updateComment() {
            var comment = document.getElementById("comment");
            socket.emit('updateComment', comment.value);
        }

        //account input
        document.getElementById('accountfile').addEventListener('change', function() {
            var fr=new FileReader();
            fr.onload=function(){
                //Read file content
                var res = fr.result.split("\r\n");
                console.log(res);
                socket.emit('accountfile', res);
            }
            fr.readAsText(this.files[0]);
        });

        //video input
        document.getElementById('videofile').addEventListener('change', function() {
            var fr=new FileReader();
            fr.onload=function(){
                //Read file content
                var res = fr.result.split("0000");
                console.log(res);
                socket.emit('videofile', res);
            }
            fr.readAsText(this.files[0]);
        })

        //time input
        document.getElementById('timeFile').addEventListener('change', function() {
            var fr=new FileReader();
            fr.onload=function(){
                //Read file content
                var res = fr.result.split("\r\n");
                console.log(res);
                socket.emit('timeFile', res);
            }
            fr.readAsText(this.files[0]);
        })

        //action input
        document.getElementById('actionFile').addEventListener('change', function() {
            var fr=new FileReader();
            fr.onload=function(){
                //Read file content
                var res = fr.result.split("\r\n");
                console.log(res);
                socket.emit('actionFile', res);
            }
            fr.readAsText(this.files[0]);
        })

        //update status
        socket.on("statusupdate", function(name, status) {
            document.getElementById("status"+name).innerHTML=status;
            console.log("mes: "+status+"     "+name);
        })
    </script>
</html>